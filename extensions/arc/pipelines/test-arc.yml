steps:
  - task: Bash@3
    displayName: 'Create environment variables'
    inputs:
      targetType: filePath
      filePath: './build/scripts/stress/create-environment-variables.sh'
    env:
      SPN_CLIENT_SECRET: $(SPN_CLIENT_SECRET)
      WORKSPACE_SHARED_KEY: $(WORKSPACE_SHARED_KEY)
      SOURCE_DOCKER_PASSWORD: $(SOURCE_DOCKER_PASSWORD)
      AZDATA_PASSWORD: $(AZDATA_PASSWORD)
      OPENSHIFT_PASSWORD: $(OPENSHIFT_PASSWORD)
  - task: Bash@3
    displayName: 'Install Prerequisites'
    inputs:
      targetType: filePath
      filePath: './build/scripts/stress/setup-prerequisites.sh'
  - task: Bash@3
    displayName: 'Fetch Nightly Build Image Tag'
    inputs:
      targetType: filePath
      filePath: './extensions/arc/scripts/fetch-nightly-build-tag.sh'
  - task: Bash@3
    displayName: 'Install Kubernetes'
    inputs:
      targetType: filePath
      filePath: './build/scripts/stress/setup-kubernetes.sh'
  - script: |
      set -e
      ./extensions/arc/scripts/start-kubeadm.sh
    displayName: Start kubeadm k8
    condition: succeeded()
